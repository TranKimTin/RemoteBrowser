<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <title>Remote Browser</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }

    canvas {
      border: 1px solid #444;
      cursor: crosshair;
    }

    #pasteCatcher {
      opacity: 0;
      position: fixed;
      left: -1000px;
    }
  </style>
</head>

<body>
  <canvas id="screen"></canvas>
  <textarea id="pasteCatcher"></textarea>

  <script>
    const ws = new WebSocket('ws://' + location.host);
    const canvas = document.getElementById('screen');
    const ctx = canvas.getContext('2d');
    const pasteCatcher = document.getElementById('pasteCatcher');

    ws.onmessage = async e => {
      const data = JSON.parse(e.data);

      if (data.type === 'frame') {
        const img = new Image();
        img.src = 'data:image/jpeg;base64,' + data.image;
        img.onload = () => {
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);
        };
      }

      if (data.type === 'clipboard') {
        try {
          await navigator.clipboard.writeText(data.text);
          console.log('ðŸ“‹ Nháº­n clipboard tá»« remote:', data.text);
        } catch {
          const el = document.createElement('textarea');
          el.value = data.text;
          document.body.appendChild(el);
          el.select();
          document.execCommand('copy');
          el.remove();
          console.log('ðŸ“‹ Fallback copy:', data.text);
        }
      }
    };

    // --- Mouse ---
    canvas.addEventListener('mousemove', e => sendMouse('move', e));
    canvas.addEventListener('mousedown', e => sendMouse('down', e));
    canvas.addEventListener('mouseup', e => sendMouse('up', e));
    canvas.addEventListener('wheel', e => {
      ws.send(JSON.stringify({ type: 'mouse', subtype: 'wheel', deltaY: e.deltaY }));
    });

    function sendMouse(subtype, e) {
      ws.send(JSON.stringify({
        type: 'mouse',
        subtype,
        x: e.offsetX,
        y: e.offsetY,
        button: e.button === 2 ? 'right' : 'left'
      }));
    }

    // --- Keyboard ---
    window.addEventListener('keydown', e => {
      ws.send(JSON.stringify({ type: 'key', subtype: 'down', key: e.key }));
    });
    window.addEventListener('keyup', e => {
      ws.send(JSON.stringify({ type: 'key', subtype: 'up', key: e.key }));
    });

    // --- Clipboard: báº¯t sá»± kiá»‡n paste tháº­t ---
    window.addEventListener('paste', e => {
      let text = '';
      if (e.clipboardData && e.clipboardData.getData) {
        text = e.clipboardData.getData('text');
      } else {
        text = pasteCatcher.value;
      }
      if (text.trim()) {
        ws.send(JSON.stringify({ type: 'clipboard', text }));
        console.log('ðŸ“¤ Gá»­i clipboard (paste event):', text);
      }
    });

    // --- Fallback khi Ctrl+V khÃ´ng paste trá»±c tiáº¿p ---
    window.addEventListener('keydown', e => {
      if (e.ctrlKey && e.key.toLowerCase() === 'v') {
        pasteCatcher.value = '';
        pasteCatcher.focus();
        setTimeout(() => pasteCatcher.blur(), 300);
      }
    });

    // --- Cáº¥m menu chuá»™t pháº£i ---
    window.addEventListener('contextmenu', e => e.preventDefault());
  </script>
</body>

</html>